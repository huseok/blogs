(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{485:function(t,a,n){"use strict";n.r(a);var s=n(3),e=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"android-四大组件部分基础知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#android-四大组件部分基础知识"}},[t._v("#")]),t._v(" Android 四大组件部分基础知识")]),t._v(" "),a("h2",{attrs:{id:"一、-activity"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、-activity"}},[t._v("#")]),t._v(" 一、 Activity")]),t._v(" "),a("h3",{attrs:{id:"_1-activity-生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-activity-生命周期"}},[t._v("#")]),t._v(" 1. Activity 生命周期")]),t._v(" "),a("p",[a("strong",[t._v("onCreate")]),t._v(" -> onContentChanged -> "),a("strong",[t._v("onStart")]),t._v(" -> onPostCreate -> "),a("strong",[t._v("onResume")]),t._v(" -> onPostResume -> "),a("strong",[t._v("onPause")]),t._v(" -> "),a("strong",[t._v("onStop")]),t._v(" -> "),a("strong",[t._v("onDestroy")])]),t._v(" "),a("h3",{attrs:{id:"_2-activity-启动模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-activity-启动模式"}},[t._v("#")]),t._v(" 2. Activity 启动模式")]),t._v(" "),a("ul",[a("li",[t._v("standard（默认）：每次启动新实例；")]),t._v(" "),a("li",[t._v("singleTop: 栈顶复用（如微信通知打开聊天窗口）（已有实例会调用 onNewIntent）")]),t._v(" "),a("li",[t._v("singleTask: 栈内复用（如应用home页）（已有实例会调用 onNewIntent）")]),t._v(" "),a("li",[t._v("singleInstance：单独栈中唯一实例（如电话拨号）")])]),t._v(" "),a("h3",{attrs:{id:"_3-fragment-生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-fragment-生命周期"}},[t._v("#")]),t._v(" 3.Fragment 生命周期")]),t._v(" "),a("ol",[a("li",[t._v("onAttach\n"),a("ul",[a("li",[t._v("Fragment与Activity绑定时调用，可获取Activity引用，仅调用一次")])])]),t._v(" "),a("li",[t._v("onCreate\n"),a("ul",[a("li",[t._v("Fragment创建时调用，初始化数据（如viewModel、数据加载），与Activity的onCreate对应，仅调用一次。")])])]),t._v(" "),a("li",[t._v("onCreateView\n"),a("ul",[a("li",[t._v("创建Fragment的视图，返回View对象（可为null），用于加载xml布局（如inflater.inflate(R.layout.fragment_main, container, false)）")])])]),t._v(" "),a("li",[t._v("onViewCreated\n"),a("ul",[a("li",[t._v("视图创建完成后调用，可初始化View控件，避免在onCreateView中直接操作View。")])])]),t._v(" "),a("li",[t._v("onActivityCreated\n"),a("ul",[a("li",[t._v("宿主Activity的onCreate执行完毕后调用（已过时，推荐使用onViewCreated）")])])]),t._v(" "),a("li",[t._v("onStart\n"),a("ul",[a("li",[t._v("Fragment 可见时调用，与Activity的onStart同步")])])]),t._v(" "),a("li",[t._v("onResume\n"),a("ul",[a("li",[t._v("Fragment 可交互时调用，与Activity的onResume同步，此时Fragment处于活跃状态")])])]),t._v(" "),a("li",[t._v("onPause\n"),a("ul",[a("li",[t._v("Fragment失去焦点（activity暂停或Fragment被替换）时调用，与activity的onPause同步。")])])]),t._v(" "),a("li",[t._v("onStop\n"),a("ul",[a("li",[t._v("Fragment 不可见时调用，与activity的onStop同步")])])]),t._v(" "),a("li",[t._v("onDestroyView\n"),a("ul",[a("li",[t._v("Fragment 的视图被销毁时调用，需要释放view相关的资源（如解绑listener），此时getView()返回null")])])]),t._v(" "),a("li",[t._v("onDetach\n"),a("ul",[a("li",[t._v("Fragment与activity解绑时调用，仅调用一次，getActivity()返回null")])])])]),t._v(" "),a("p",[t._v("Fragment 的生命周期完全依赖于 Activity 的生命周期，Activity 的生命周期变化会直接触发 Fragment 的对应阶段，具体映射关系如下：")]),t._v(" "),a("p",[t._v("Fragment的生命周期完全依赖于Activity的生命周期，"),a("strong",[t._v("Activity的生命周期变化会直接触发Fragment的对应阶段")]),t._v("，具体映射关系如下：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Activity生命周期")]),t._v(" "),a("th",[t._v("Fragment对应生命周期")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("onCreate()")]),t._v(" "),a("td",[t._v("onAttach() → onCreate() → onCreateView() → onViewCreated()")])]),t._v(" "),a("tr",[a("td",[t._v("onStart()")]),t._v(" "),a("td",[t._v("onStart()")])]),t._v(" "),a("tr",[a("td",[t._v("onResume()")]),t._v(" "),a("td",[t._v("onResume()")])]),t._v(" "),a("tr",[a("td",[t._v("onPause()")]),t._v(" "),a("td",[t._v("onPause()")])]),t._v(" "),a("tr",[a("td",[t._v("onStop()")]),t._v(" "),a("td",[t._v("onStop()")])]),t._v(" "),a("tr",[a("td",[t._v("onDestroy()")]),t._v(" "),a("td",[t._v("onDestroyView() → onDestroy() → onDetach()")])])])]),t._v(" "),a("p",[t._v("关键场景下的生命周期变化")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Fragment 被添加到 Activity"),a("br"),t._v("\nonAttach() → onCreate() → onCreateView() → onViewCreated() → onStart() → onResume()")])]),t._v(" "),a("li",[a("p",[t._v("Fragment 被替换（replace）"),a("br"),t._v("\n旧Fragment：onPause() → onStop() → onDestroyView() → onDestroy() → onDetach()"),a("br"),t._v("\n新Fragment：onAttach() → onCreate() → onCreateView() → onViewCreated() → onStart() → onResume()")])]),t._v(" "),a("li",[a("p",[t._v("Fragment 被隐藏（hide）/ 显示（show）")])])]),t._v(" "),a("ul",[a("li",[t._v("隐藏：仅触发onHiddenChanged(true)（无生命周期方法调用）；")]),t._v(" "),a("li",[t._v("显示：仅触发onHiddenChanged(false)（无生命周期方法调用）；\n（注：hide/show不销毁视图，仅控制可见性）")])]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("Fragment 被添加到回退栈（addToBackStack）")])]),t._v(" "),a("ul",[a("li",[t._v("替换 Fragment 时加入回退栈：旧 Fragment 仅执行onPause() → onStop() → onDestroyView()（视图销毁，实例保留）；")]),t._v(" "),a("li",[t._v("从回退栈恢复：旧 Fragment 执行onCreateView() → onViewCreated() → onStart() → onResume()（视图重建）。")])]),t._v(" "),a("p",[t._v("Fragment.setRetaininstance(true)有什么作用??(注意:此方法已弃用，但\n了解其原理仍有价值)"),a("br"),t._v("\n当 Activity 因配置变化（如横竖屏切换、屏幕尺寸调整）销毁并重建时，默认情况下 Fragment 会随 Activity 一起销毁（执行onDestroy()→onDetach()），再重新创建新实例。")]),t._v(" "),a("h3",{attrs:{id:"_4-fragment-与-activity-通信的方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-fragment-与-activity-通信的方式"}},[t._v("#")]),t._v(" 4. Fragment 与 Activity 通信的方式")]),t._v(" "),a("ul",[a("li",[t._v("通过接口回调（Fragment 定义接口，Activity 实现）；")]),t._v(" "),a("li",[t._v("使用 ViewModel（共享数据，生命周期独立于 Fragment）；")]),t._v(" "),a("li",[t._v("通过setArguments()/getArguments()传递数据；")]),t._v(" "),a("li",[t._v("使用 LiveData/EventBus 实现跨组件通信。")])]),t._v(" "),a("h3",{attrs:{id:"intent-与-intent-filter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#intent-与-intent-filter"}},[t._v("#")]),t._v(" Intent 与 Intent Filter.")]),t._v(" "),a("ol",[a("li",[t._v("显式Intent\n"),a("ul",[a("li",[t._v("直接指定目标组件的类名（如 Activity、Service），系统直接匹配目标组件，无需 Intent Filter")])])]),t._v(" "),a("li",[t._v("隐式Intent\n"),a("ul",[a("li",[t._v("不指定具体组件，通过Action、Category、Data等属性描述意图，系统通过 Intent Filter 匹配最合适的组件")])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 打开浏览器访问网址")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Intent")]),t._v(" intent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Intent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Intent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ACTION_VIEW")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nintent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://www.baidu.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("startActivity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("intent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),a("li",[t._v("Intent 通过 "),a("strong",[t._v("Binder")]),t._v(" 传递，数据大小限制约 "),a("strong",[t._v("1MB")]),t._v("；大数据可通过FileProvider、Binder或本地存储（文件 / 数据库）传递。")])]),t._v(" "),a("h2",{attrs:{id:"二、service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、service"}},[t._v("#")]),t._v(" 二、Service")]),t._v(" "),a("h3",{attrs:{id:"service生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service生命周期"}},[t._v("#")]),t._v(" Service生命周期")]),t._v(" "),a("ol",[a("li",[t._v("启动服务 onCreate -> onStartConmmand -> onDestroy;")])]),t._v(" "),a("ul",[a("li",[t._v("startService(new Intent(this,Myservice.class)),服务独立运行，需手动停止（stopSelf()（自身）/stopService()（外部））")])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("绑定服务 onCreate -> onBind ->onUnbind -> onDestroy;")])]),t._v(" "),a("ul",[a("li",[t._v("bindService(intent,serviceConnection,BIND_AUTO_CREATE),与组件绑定，组件销毁时服务解绑。")])]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("即启动又绑定：需同时stopService()和unbindService才会销毁。")])]),t._v(" "),a("p",[t._v("Foreground Service()前台服务\n在 onStartCommand() 中调用 startForeground() 将服务提升为前台服务（需传入通知 ID 和 Notification 对象）在 Activity 中通过 startForegroundService() 启动（Android 8.0+ 必须用此方法，而非 startService()）  停止服务：调用 stopForeground(true) 可移除通知并降级为普通服务，或 stopSelf() 直接停止服务。\n前台服务必须显示通知，且通知需包含小图标（setSmallIcon()），否则会抛出异常")]),t._v(" "),a("h2",{attrs:{id:"三、broadcastreceiver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、broadcastreceiver"}},[t._v("#")]),t._v(" 三、BroadcastReceiver")]),t._v(" "),a("p",[t._v("作用：监听系统 / 应用发出的广播事件（如网络变化、开机完成），实现组件间通信。")]),t._v(" "),a("h3",{attrs:{id:"基础使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础使用"}},[t._v("#")]),t._v(" 基础使用：")]),t._v(" "),a("ul",[a("li",[t._v("定义：继承BroadcastReceiver，重写onReceive(Context context, Intent intent)")]),t._v(" "),a("li",[t._v("注册方式：\n"),a("ol",[a("li",[t._v("静态注册：AndroidManifest.xml中注册，常驻系统（即使应用关闭）")]),t._v(" "),a("li",[t._v("动态注册：代码中注册（registerReceiver(receiver, intentFilter)）,需在onDestroy()中解绑（unregisterReceiver(receiver)）")])])])]),t._v(" "),a("h3",{attrs:{id:"发送广播"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发送广播"}},[t._v("#")]),t._v(" 发送广播")]),t._v(" "),a("ul",[a("li",[t._v("普通广播：sendBroadcast(intent),异步传递，可被多个接收器接收；")]),t._v(" "),a("li",[t._v("有序广播：sendOrderedBroadcast(intent,null),可按优先级传递，可中断；")]),t._v(" "),a("li",[t._v("本地广播：LocalBroadcastManager发送，仅自己应用内接收，更安全。")])]),t._v(" "),a("h2",{attrs:{id:"四、contentprovider"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、contentprovider"}},[t._v("#")]),t._v(" 四、ContentProvider")]),t._v(" "),a("p",[t._v("ContentProvider 是 Android 四大组件之一，本质是跨进程数据交互的 “中间者” ，自身不存储数据，仅封装数据访问接口，真正数据源可为 SQLite 数据库、文件、XML 或网络数据。 底层是基于Android的"),a("strong",[t._v("Binder")]),t._v("机制实现跨进程通信，通过Binder代理完成客户端（ContentResolver）与服务端（ContentProvider）的数据交互。")]),t._v(" "),a("h3",{attrs:{id:"基础使用-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础使用-2"}},[t._v("#")]),t._v(" 基础使用")]),t._v(" "),a("ol",[a("li",[t._v("定义：继承ContentProvider，重写onCreate()、query()、insert()、update()、delete()、getType();")]),t._v(" "),a("li",[t._v("注册：AndroidManifest.xml中注册")]),t._v(" "),a("li",[t._v("访问数据：通过ContentResolver调用方法，如\n"),a("code",[t._v('getContentResolver().query(Uri.pare("content://com.example.myprovider/data"),null,null,null,null)')]),t._v("\ngetType返回当前Uri所代表数据的MIME类型")])]),t._v(" "),a("h3",{attrs:{id:"contentresolver-类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#contentresolver-类"}},[t._v("#")]),t._v(" ContentResolver 类")]),t._v(" "),a("ul",[a("li",[t._v("作用：统一管理对不同ContentProvider的操作，避免客户端直接与多个ContentProvider交互复杂性。")]),t._v(" "),a("li",[t._v("核心方法 ：提供与ContentProvier对应的4个数据操作方法，通过Context.getContentResolver()获取实例：")])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ContentResolver")]),t._v(" resolver "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getContentResolver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 插入数据")]),t._v("\nresolver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uri"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" values"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 查询数据")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cursor")]),t._v(" cursor "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" resolver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uri"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" projection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" selection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" selectionArgs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sortOrder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 更新数据")]),t._v("\nresolver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uri"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" values"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" selection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" selectionArgs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 删除数据")]),t._v("\nresolver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uri"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" selection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" selectionArgs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h4",{attrs:{id:"_4-辅助工具类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-辅助工具类"}},[t._v("#")]),t._v(" （4）辅助工具类")]),t._v(" "),a("h5",{attrs:{id:"_1-contenturis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-contenturis"}},[t._v("#")]),t._v(" ① ContentUris")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("作用")]),t._v("：简化URI的“追加ID”与“解析ID”操作。")]),t._v(" "),a("li",[a("strong",[t._v("核心方法")]),t._v("：\n"),a("ul",[a("li",[a("code",[t._v("withAppendedId(Uri baseUri, long id)")]),t._v("：向基础URI追加ID，示例："),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uri")]),t._v(" baseUri "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"content://com.carson.provider/User"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uri")]),t._v(" newUri "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ContentUris")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withAppendedId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("baseUri"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 结果：content://com.carson.provider/User/7")]),t._v("\n")])])])]),t._v(" "),a("li",[a("code",[t._v("parseId(Uri uri)")]),t._v("：从URI中解析出ID，示例："),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ContentUris")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newUri"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 结果：7")]),t._v("\n")])])])])])])]),t._v(" "),a("h5",{attrs:{id:"_2-urimatcher"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-urimatcher"}},[t._v("#")]),t._v(" ② UriMatcher")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("作用")]),t._v("：注册URI并根据URI匹配对应的数据表，解决“不同URI对应不同数据资源”的映射问题。")]),t._v(" "),a("li",[a("strong",[t._v("使用步骤")]),t._v("：\n"),a("ol",[a("li",[t._v("初始化："),a("code",[t._v("UriMatcher matcher = new UriMatcher(UriMatcher.NO_MATCH);")]),t._v("（NO_MATCH表示初始不匹配任何URI）；")]),t._v(" "),a("li",[t._v("注册URI："),a("code",[t._v("matcher.addURI(Authority, Path, 匹配码);")]),t._v("，示例："),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("matcher"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addURI")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.carson.provider"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"User"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// URI=content://com.carson.provider/User时，匹配码=1")]),t._v("\nmatcher"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addURI")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.carson.provider"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Job"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// URI=content://com.carson.provider/Job时，匹配码=2")]),t._v("\n")])])])]),t._v(" "),a("li",[t._v("匹配URI："),a("code",[t._v("int matchCode = matcher.match(uri);")]),t._v("，根据匹配码确定对应数据表。")])])])]),t._v(" "),a("h5",{attrs:{id:"_3-contentobserver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-contentobserver"}},[t._v("#")]),t._v(" ③ "),a("strong",[t._v("ContentObserver")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("定义")]),t._v("：内容观察者，监听URI对应ContentProvider的数据变化，并通知外界。")]),t._v(" "),a("li",[a("strong",[t._v("使用步骤")]),t._v("：\n"),a("ol",[a("li",[a("strong",[t._v("注册观察者")]),t._v("：通过ContentResolver注册，指定监听的URI："),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getContentResolver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerContentObserver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uri"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyContentObserver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),a("li",[a("strong",[t._v("发送通知")]),t._v("：ContentProvider数据变化时（如insert/delete/update后），调用"),a("code",[t._v("notifyChange()")]),t._v("通知观察者："),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getContentResolver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("notifyChange")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uri"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),a("li",[a("strong",[t._v("处理变化")]),t._v("：自定义ContentObserver并重写"),a("code",[t._v("onChange()")]),t._v("，响应数据变化（如刷新UI）："),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyContentObserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ContentObserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onChange")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" selfChange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onChange")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("selfChange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 数据变化后的操作（如重新查询数据）")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("li",[a("strong",[t._v("解除观察者")]),t._v("：在组件销毁时解除，避免内存泄漏："),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onDestroy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onDestroy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getContentResolver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("unregisterContentObserver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("observer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])])]),t._v(" "),a("h3",{attrs:{id:"contentprovider-实例演示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#contentprovider-实例演示"}},[t._v("#")]),t._v(" ContentProvider 实例演示")]),t._v(" "),a("h4",{attrs:{id:"_1-进程内通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-进程内通信"}},[t._v("#")]),t._v(" （1）进程内通信")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("步骤")]),t._v(" "),a("th",[t._v("操作内容")]),t._v(" "),a("th",[t._v("关键代码示例")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("1")]),t._v(" "),a("td",[t._v("创建DBHelper（初始化数据库）")]),t._v(" "),a("td",[t._v("继承SQLiteOpenHelper，重写onCreate()创建表（如User表、Job表）")])]),t._v(" "),a("tr",[a("td",[t._v("2")]),t._v(" "),a("td",[t._v("自定义ContentProvider")]),t._v(" "),a("td",[t._v("重写6个核心方法，通过UriMatcher匹配URI与数据表，操作SQLite")])]),t._v(" "),a("tr",[a("td",[t._v("3")]),t._v(" "),a("td",[t._v("注册ContentProvider")]),t._v(" "),a("td",[t._v("在Manifest中注册："),a("code",[t._v('<provider android:name=".MyProvider" android:authorities="com.carson.provider"/>')])])]),t._v(" "),a("tr",[a("td",[t._v("4")]),t._v(" "),a("td",[t._v("访问数据")]),t._v(" "),a("td",[t._v("通过ContentResolver根据URI插入、查询数据")])])])]),t._v(" "),a("h4",{attrs:{id:"_2-进程间通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-进程间通信"}},[t._v("#")]),t._v(" （2）进程间通信")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("进程1（服务端）")]),t._v("：\n"),a("ol",[a("li",[t._v("完成“进程内通信”的3个步骤（DBHelper、自定义ContentProvider、注册）；")]),t._v(" "),a("li",[t._v("在Manifest中声明访问权限："),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("permission")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("com.carson.provider.PERMISSION"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("protectionLevel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("normal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("provider")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v(".MyProvider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("authorities")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("com.carson.provider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("permission")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("com.carson.provider.PERMISSION"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("exported")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("true"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 允许其他进程访问 --\x3e")]),t._v("\n")])])])])])]),t._v(" "),a("li",[a("strong",[t._v("进程2（客户端）")]),t._v("：\n"),a("ol",[a("li",[t._v("在Manifest中声明权限："),a("code",[t._v('<uses-permission android:name="com.carson.provider.PERMISSION"/>')]),t._v("；")]),t._v(" "),a("li",[t._v("通过ContentResolver访问进程1的ContentProvider（代码与进程内通信一致，URI需匹配进程1的Authority）。")])])])]),t._v(" "),a("h3",{attrs:{id:"contentprovider-核心优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#contentprovider-核心优点"}},[t._v("#")]),t._v(" ContentProvider 核心优点")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("安全性")]),t._v("：仅通过封装的接口开放数据访问，避免直接开放数据库权限导致的安全风险；")]),t._v(" "),a("li",[a("strong",[t._v("访问高效性")]),t._v("：解耦底层数据存储方式（如从SQLite切换为MongoDB），上层访问代码无需修改，统一访问接口；")]),t._v(" "),a("li",[a("strong",[t._v("通用性")]),t._v("：支持多种数据源，且适配进程内、进程间两种通信场景。")])])])}),[],!1,null,null,null);a.default=e.exports}}]);